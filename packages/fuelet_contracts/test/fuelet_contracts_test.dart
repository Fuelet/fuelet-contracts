// ignore_for_file: avoid_print

import 'dart:ffi';
import 'dart:io';

import 'package:fuelet_contracts/fuelet_contracts.dart';
import 'package:test/test.dart';

String projectPath = Directory.current.parent.parent.path;
final dynLib =
    DynamicLibrary.open('$projectPath/target/debug/libfuelet_contracts.dylib');
var rustSdk = FueletContractsImpl(dynLib);

const betaApiUrl = 'https://beta-3.fuel.network';

String swayTokenAssetId =
    '0x89eac25d412c5c1b63d212deacc109dcff804eff70101fe0fc72167bc7884aa2';
String predicateSecret =
    '2ee0702d32bade831ecf5ebf6707db9452a1be9d508f2fce9d0e4b3b4be751bd';
String predicateBytecode =
    '900000044700000000000000000002c85dfcc00110fff30071480003614521017344000b6161210d9000001272400002134114005a410001734000116161211f90000012240000001a505000910004f85d47f009104513005d43f009104103005d5ff00a105d7300614c02027248002028513480504d44d872480020284d4480505944d850554068724800201b4c0480104d54c072480020284d1480724800201b4c1480104d54c072480020284d1480504d417072440040284d544050494478724400402849344050554478504d40a872440040284d84405049422872440020284964403e5534801a4480001345104073440047505541e05f540000504d4478504950087244004028493440504d433872440048284d544090000051505541285f541000504d41d85f4c0000504950407244000828493440504d433872440048284d5440504944307244004828493440504544305d451000134510407344008d504d4430504942f07244004828493440504542f05d451000134510007344006136000000504542f0504d1008504943f07244004028493440504943f0724400201b58044010592580504943f0724400201b54144010552540504d40e872440020284d6440504930207244002028495440504944b87244002028490440504944b85045424872400040284534005d43f00840491400504543a87240002028452400504d41b05f4c0000504543a85049404872400020284914005045300872400020284524005045438072400028284534009000009b5041443050490040504543c87240000828452400504d40205f4c1000504943c8504530207240000828452400504543807240002828453400504942c87240002828491400504142c85d41000013410000734000a336000000504142c850490008504543d07240002028452400504543d0504942887240002028491400504542a8724000202845740050400020294124502440000000000000000000000000000000000000000000000000000000000000000000003b421fbbb41ae9aa69028615c34811125d057eb033e4b39e1d8957dc434d7145000000000000004000000000000002c800000000000002e8';
String receiver =
    'fuel1h68gth3dvlhzd9v0p6wx0ee7uwvhnyxn4zhtcstz6amtmlyu3cvsn8eytp';

void main() {
  test('get config from a token contract', () async {
    var tokenContract = await TokenContract.newTokenContract(
        bridge: rustSdk, nodeUrl: betaApiUrl);
    var response = await tokenContract.config(contractId: swayTokenAssetId);
    expect(response.name, 'Sway token                      ');
    expect(response.symbol, 'SWAY    ');
    expect(response.decimals, 9);
  });

  test('get address from a predicate', () async {
    var pred = await SendCoinsPredicate.newSendCoinsPredicate(
        bridge: rustSdk, nodeUrl: betaApiUrl, codeHex: predicateBytecode);
    var address = await pred.address();
    expect(address,
        'fuel1gxezay0x3sa2fpk3uqupahqdxqy6u0hqvlqghk4v3vh9kxjvc7hq0nrp58');
  });

  test('transfer coins from predicate', () async {
    var pred = await SendCoinsPredicate.newSendCoinsPredicate(
        bridge: rustSdk, nodeUrl: betaApiUrl, codeHex: predicateBytecode);
    var txId = await pred.transferTo(
        to: receiver, secret: predicateSecret, amount: 100);
    print(txId);
  });
}
